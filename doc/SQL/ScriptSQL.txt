CREATE DATABASE training_sales_db
CHARACTER SET utf8mb4
COLLATE utf8mb4_unicode_ci;

USE training_sales_db;

-- Création des tables

-- Table User
CREATE TABLE User (
    id_User BIGINT AUTO_INCREMENT PRIMARY KEY,
    u_login VARCHAR(50) NOT NULL UNIQUE,
    u_password VARCHAR(255) NOT NULL,
    u_role VARCHAR(20) DEFAULT 'USER',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB;

-- Table Client
CREATE TABLE Client (
    id_Client BIGINT AUTO_INCREMENT PRIMARY KEY,
    cl_firstName VARCHAR(100) NOT NULL,
    cl_lastName VARCHAR(100) NOT NULL,
    cl_email VARCHAR(150) NOT NULL UNIQUE,
    cl_address VARCHAR(255),
    cl_phoneNumber VARCHAR(20),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB;

-- Table Course (SANS contrainte inline problématique)
CREATE TABLE Course (
    id_Course BIGINT AUTO_INCREMENT PRIMARY KEY,
    co_name VARCHAR(200) NOT NULL,
    co_description TEXT,
    co_duration INT NOT NULL,
    co_type VARCHAR(20) NOT NULL,
    co_price DECIMAL(10, 2) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT chk_course_type CHECK (co_type IN ('IN-PERSON', 'REMOTE'))
) ENGINE=InnoDB;

-- Table Cart
CREATE TABLE Cart (
    id_Cart BIGINT AUTO_INCREMENT PRIMARY KEY,
    ca_createdDate TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    id_User BIGINT NOT NULL,
    FOREIGN KEY (id_User) REFERENCES User(id_User) ON DELETE CASCADE
) ENGINE=InnoDB;

-- Table Order
CREATE TABLE `Order` (
    id_Order BIGINT AUTO_INCREMENT PRIMARY KEY,
    o_orderDate TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    o_totalAmount DECIMAL(10, 2) NOT NULL,
    id_User BIGINT NOT NULL,
    id_Client BIGINT NOT NULL,
    FOREIGN KEY (id_User) REFERENCES User(id_User) ON DELETE RESTRICT,
    FOREIGN KEY (id_Client) REFERENCES Client(id_Client) ON DELETE RESTRICT
) ENGINE=InnoDB;

-- Table CartLine
CREATE TABLE CartLine (
    id_CartLine BIGINT AUTO_INCREMENT PRIMARY KEY,
    car_quantity INT NOT NULL DEFAULT 1,
    id_Cart BIGINT NOT NULL,
    id_Course BIGINT NOT NULL,
    FOREIGN KEY (id_Cart) REFERENCES Cart(id_Cart) ON DELETE CASCADE,
    FOREIGN KEY (id_Course) REFERENCES Course(id_Course) ON DELETE CASCADE,
    UNIQUE KEY unique_cart_course (id_Cart, id_Course)
) ENGINE=InnoDB;

-- Table OrderLine
CREATE TABLE OrderLine (
    id_OrderLine BIGINT AUTO_INCREMENT PRIMARY KEY,
    ol_quantity INT NOT NULL DEFAULT 1,
    ol_unitPrice DECIMAL(10, 2) NOT NULL,
    id_Order BIGINT NOT NULL,
    id_Course BIGINT NOT NULL,
    FOREIGN KEY (id_Order) REFERENCES `Order`(id_Order) ON DELETE CASCADE,
    FOREIGN KEY (id_Course) REFERENCES Course(id_Course) ON DELETE RESTRICT
) ENGINE=InnoDB;

-- Création des index
CREATE INDEX idx_course_type ON Course(co_type);
CREATE INDEX idx_course_name ON Course(co_name);
CREATE INDEX idx_user_login ON User(u_login);
CREATE INDEX idx_user_role ON User(u_role);
CREATE INDEX idx_client_email ON Client(cl_email);
CREATE INDEX idx_order_date ON `Order`(o_orderDate);

-- ========================================
-- INSERTION DES DONNÉES
-- ========================================

-- Insertion des utilisateurs (1 admin + 2 users)
INSERT INTO User (u_login, u_password, u_role) VALUES
('admin', 'admin123', 'ADMIN'),
('testuser', 'password', 'USER'),
('john.doe', 'test2026', 'USER');

INSERT INTO Course (co_name, co_description, co_duration, co_type, co_price) VALUES
-- Programming & Development
('Java Advanced', 'In-depth training on Java 17, Spring Boot and microservices architecture', 5, 'IN-PERSON', 1500.00),
('Python Full Stack', 'Complete Python development with Django and Flask frameworks', 6, 'REMOTE', 1200.00),
('JavaScript Mastery', 'Modern JavaScript ES6+, async programming and best practices', 4, 'REMOTE', 950.00),
('React & Redux', 'Build scalable applications with React, Redux and TypeScript', 5, 'IN-PERSON', 1400.00),
('Angular Complete', 'Master Angular framework from basics to advanced concepts', 4, 'REMOTE', 1100.00),
('Docker & Kubernetes', 'Container orchestration and cloud-native applications', 4, 'IN-PERSON', 1300.00),
('AWS Solutions Architect', 'Design and deploy scalable systems on Amazon Web Services', 5, 'REMOTE', 1600.00),
('CI/CD with Jenkins', 'Continuous integration and deployment automation', 3, 'REMOTE', 800.00),
('Terraform Infrastructure', 'Infrastructure as Code with Terraform and cloud providers', 3, 'IN-PERSON', 900.00),
('Machine Learning Fundamentals', 'Introduction to ML algorithms and practical applications', 6, 'REMOTE', 1800.00),
('Data Analysis with Python', 'Pandas, NumPy and data visualization techniques', 4, 'REMOTE', 1000.00),
('SQL Database Design', 'Relational database modeling and optimization', 3, 'IN-PERSON', 750.00),
('Cybersecurity Essentials', 'Network security, encryption and ethical hacking basics', 5, 'IN-PERSON', 1500.00),
('Test Automation Selenium', 'Automated testing with Selenium WebDriver and frameworks', 3, 'REMOTE', 850.00),
('Agile & Scrum Master', 'Agile methodologies and Scrum framework certification prep', 2, 'IN-PERSON', 600.00);

-- ========================================
-- VÉRIFICATIONS
-- ========================================

SELECT '========== USERS ==========' AS '';
SELECT id_User, u_login, u_role FROM User;

SELECT '========== COURSES ==========' AS '';
SELECT
    id_Course,
    co_name,
    co_duration,
    co_type,
    co_price
FROM Course
ORDER BY id_Course;
